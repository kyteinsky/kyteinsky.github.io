<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Final report on GSoC progress"><title>GSoC Finale</title><link rel=canonical href=https://kyteinsky.github.io/p/gsoc-finale/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="GSoC Finale"><meta property="og:description" content="Final report on GSoC progress"><meta property="og:url" content="https://kyteinsky.github.io/p/gsoc-finale/"><meta property="og:site_name" content="kyte codes"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="gsoc"><meta property="article:tag" content="gnome"><meta property="article:published_time" content="2022-09-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-09-16T00:00:00+00:00"><meta property="og:image" content="https://kyteinsky.github.io/p/gsoc-finale/blank.svg"><meta name=twitter:title content="GSoC Finale"><meta name=twitter:description content="Final report on GSoC progress"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kyteinsky.github.io/p/gsoc-finale/blank.svg"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended
on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu11112e8503aeb9bc837ec913758b86a7_10683_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></figure><h1 class=site-name><a href=https://kyteinsky.github.io>kyte codes</a></h1><h2 class=site-description>Developer to the rescue</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/gsoc-finale/><img src=/p/gsoc-finale/blank.svg loading=lazy alt="Featured image of post GSoC Finale"></a></div><div class=article-details><header class=article-category><a href=/categories/gsoc/ style=background-color:#f9ab00;color:#000>GSoC</a></header><h2 class=article-title><a href=/p/gsoc-finale/>GSoC Finale</a></h2><h3 class=article-subtitle>Final report on GSoC progress</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Sep 16, 2022</time></footer></div></header><section class=article-content><p>It definitely was a long journey. Although I didn&rsquo;t write enough blogs to outline the exact shaping of it, here&rsquo;s a final report on what has been going on.</p><p>The workings of the protocol and the connection specifics have already been discussed before, so let&rsquo;s keep this short.</p><ul><li>Discovery using mDNS</li><li>Connection over TCP</li><li>Messages are structured in JSON and encoded using protobuf</li><li>All the messages have at least a <code>sender id</code>, <code>destination id</code>, <code>namespace</code>, <code>payload type</code>, and the <code>payload</code> itself</li></ul><p>Last time we connected to the Chromecast device, we opened a media receiver web app and played a video on it.<br>Our goal, as it remains, is to cast our desktop/window on the Chromecast display. We can choose from three different streaming protocols to have what we want: DASH, HLS, and Smooth Streaming.</p><p>Implementing one of those was the primary goal until a sparse study of Chromium&rsquo;s code unveiled a namespace called <code>urn:x-cast:com.google.cast.webrtc</code>.<br>We also used Google Chrome&rsquo;s (or Chromium&rsquo;s) tab casting feature and recorded the logs. Looking at the logs virtually revealed the entire message exchange and the steps involved, but it was no documentation by any stretch. We had no idea what the possibilities were or the error cases, for that matter.<br>While trying to figure out the Chromecast protocol, we noticed many logs in the message exchange files that were not in Chrome&rsquo;s logs, even with the highest level of verbosity. <code>DLOG</code> and <code>VLOG</code>, for example, did not print out the <code>DLOG</code>, where I suspect D stands for development and V for verbose.<br>It would have been easier to see what exactly happens with Chrome&rsquo;s logs. We tried using the dev symbols that come with the Linux distribution, but Arch Linux had some issues at the time.<br>Nevertheless, I don&rsquo;t suppose that would&rsquo;ve worked for the logs.</p><p>So the only option left was to read the code and figure it out ourselves. And that&rsquo;s what we did since no one was successful with the webrtc stream before on the internet.<br>We came across <a class=link href=https://source.chromium.org/chromium/chromium/src/+/main:third_party/openscreen/src/cast/ target=_blank rel=noopener>this directory</a>. It contained all the knowledge there was. The proto files, the json schemas, the header files with all the constants, all the good stuff we needed. From the names of the files itself we knew how to send the stream to Chromecast, except that we didn&rsquo;t (<em>hint</em> <em>hint</em> something to do with encryption).</p><p>Let me loop back to the negotiation part of the WebRTC stream. In normal WebRTC, there is a separate entity that relays messages between the two parties interested. Here that happens to be the sender itself.<br>We open the app called <code>Chrome Mirroring</code> (app id <code>0F5096E8</code>). This is for audio and video streaming. There is also one for only audio streaming. You can find a few others <a class=link href=https://source.chromium.org/chromium/chromium/src/+/main:third_party/openscreen/src/cast/common/public/cast_streaming_app_ids.h target=_blank rel=noopener>here</a>.<br>Now, when the app is opened, we get a receiver status message, and we start communicating with the app from this point on by addressing the messages to the session id of the app, after connecting to it first.</p><p>The first thing we do is send an offer message with the necessary information for the streams we wish to send and the encryption keys, among other details. Here is an example message:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source_id&#34;</span><span class=p>:</span> <span class=s2>&#34;sender-990878&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;destination_id&#34;</span><span class=p>:</span> <span class=s2>&#34;a8a79f97-a63e-4555-baec-53e3f49e6df3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;urn:x-cast:com.google.cast.webrtc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;payload_utf8&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;offer&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;castMode&#34;</span><span class=p>:</span> <span class=s2>&#34;mirroring&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;receiverGetStatus&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;supportedStreams&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;aesIvMask&#34;</span><span class=p>:</span> <span class=s2>&#34;1D20EA1C710E5598ECF80FB26ABC57B0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;aesKey&#34;</span><span class=p>:</span> <span class=s2>&#34;BB0CAE24F76EA1CAC9A383CFB1CFD54E&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;bitRate&#34;</span><span class=p>:</span> <span class=mi>102000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;channels&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;codecName&#34;</span><span class=p>:</span> <span class=s2>&#34;opus&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;receiverRtcpEventLog&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;rtpExtensions&#34;</span><span class=p>:</span> <span class=s2>&#34;adaptive_playout_delay&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;rtpPayloadType&#34;</span><span class=p>:</span> <span class=mi>127</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;rtpProfile&#34;</span><span class=p>:</span> <span class=s2>&#34;cast&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;sampleRate&#34;</span><span class=p>:</span> <span class=mi>48000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;ssrc&#34;</span><span class=p>:</span> <span class=mi>144842</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;targetDelay&#34;</span><span class=p>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;timeBase&#34;</span><span class=p>:</span> <span class=s2>&#34;1/48000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;audio_source&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;aesIvMask&#34;</span><span class=p>:</span> <span class=s2>&#34;1D20EA1C710E5598ECF80FB26ABC57B0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;aesKey&#34;</span><span class=p>:</span> <span class=s2>&#34;BB0CAE24F76EA1CAC9A383CFB1CFD54E&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;codecName&#34;</span><span class=p>:</span> <span class=s2>&#34;vp8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;index&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;maxBitRate&#34;</span><span class=p>:</span> <span class=mi>5000000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;maxFrameRate&#34;</span><span class=p>:</span> <span class=s2>&#34;30000/1000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;receiverRtcpEventLog&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;renderMode&#34;</span><span class=p>:</span> <span class=s2>&#34;video&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;resolutions&#34;</span><span class=p>:</span> <span class=p>[{</span> <span class=nt>&#34;height&#34;</span><span class=p>:</span> <span class=mi>1080</span><span class=p>,</span> <span class=nt>&#34;width&#34;</span><span class=p>:</span> <span class=mi>1920</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;rtpExtensions&#34;</span><span class=p>:</span> <span class=s2>&#34;adaptive_playout_delay&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;rtpPayloadType&#34;</span><span class=p>:</span> <span class=mi>96</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;rtpProfile&#34;</span><span class=p>:</span> <span class=s2>&#34;cast&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;ssrc&#34;</span><span class=p>:</span> <span class=mi>545579</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;targetDelay&#34;</span><span class=p>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;timeBase&#34;</span><span class=p>:</span> <span class=s2>&#34;1/90000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;video_source&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;seqNum&#34;</span><span class=p>:</span> <span class=mi>730137397</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;OFFER&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>Note: only the <code>payload_utf8</code> is structured in JSON, other sibling keys are part of protobuf.</p></blockquote><p>You see that? All the details are right there in the offer message.<br>Other codecs are also supported, such as h264, vp9, hevc, and aac.<br>Although most of the things should be self-explanatory, focus on the key <code>ssrc</code> in both the audio and video streams. This is the identifier for the stream.<br>The AES keys and masks are passed down in the offer message still. The algorithm used however is <a class=link href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/openscreen/src/cast/streaming/frame_crypto.cc;l=102" target=_blank rel=noopener>AES-CTR-128</a>.</p><p>We sent an offer. We must receive an answer to it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source_id&#34;</span><span class=p>:</span> <span class=s2>&#34;a8a79f97-a63e-4555-baec-53e3f49e6df3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;destination_id&#34;</span><span class=p>:</span> <span class=s2>&#34;sender-990878&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;urn:x-cast:com.google.cast.webrtc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;payload_utf8&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;answer&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;castMode&#34;</span><span class=p>:</span> <span class=s2>&#34;mirroring&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;receiverGetStatus&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;receiverRtcpEventLog&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;rtpExtensions&#34;</span><span class=p>:</span> <span class=p>[[],</span> <span class=p>[]],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sendIndexes&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;ssrcs&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mi>144843</span><span class=p>,</span> <span class=mi>545580</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;udpPort&#34;</span><span class=p>:</span> <span class=mi>51810</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=s2>&#34;ok&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;seqNum&#34;</span><span class=p>:</span> <span class=mi>730137397</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;ANSWER&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>You&rsquo;d find it weird that the ssrc values have been incremented compared to what we sent. Apart from that, the keys that deserve our attention are <code>updPort</code>, <code>result</code>, and <code>type</code>. If the result is &ldquo;ok&rdquo;, we collect the port number and start streaming RTP packets and exchanging RTCP packets. For streaming RTP packets, we <strong>need</strong> a controller of the packets, either RTCP or RTSP. Found this out the hard way while messing around with the GStreamer launch command.</p><p>After these findings, we had some time left to reorganise the code and handle the edge cases well.<br>Daily routine was to read docs, write code, test, check logs, and repeat.</p><p>Now we had what you can call state management (just a variable and if checks) and some nice JSON string generators.<br>We jumped into media handling right on. Already having a pipeline to process video and audio in GNOME Network Displays made things easy, but tinkering with it was no easy job until <a class=link href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/index.html?gi-language=c" target=_blank rel=noopener>the saviour</a> lent a helping hand. The first few tutorials were all that was needed to get to speed.</p><p>The pipeline created for video (only) streaming looked like what follows:</p><p><figure style=flex-grow:1584;flex-basis:3803px><a href=/p/gsoc-finale/pipeline.png data-size=8763x553><img src=/p/gsoc-finale/pipeline.png srcset="/p/gsoc-finale/pipeline_hucb4e2b506f4294e55aca3bcb216d10a7_168220_480x0_resize_box_3.png 480w, /p/gsoc-finale/pipeline_hucb4e2b506f4294e55aca3bcb216d10a7_168220_1024x0_resize_box_3.png 1024w" width=8763 height=553 loading=lazy alt="Video Pipeline"></a><figcaption>Video Pipeline</figcaption></figure></p><p>You might want to zoom in a little.</p><p>This was an unencrypted RTP stream with unencrypted RTCP messages. The only thing to add was an encryption layer over the RTP packets. The plugin <code>srtpenc</code> provided by GStreamer did precisely this, except that it did not do AES-CTR, only AES-ICM and AES-GCM. Going deeper, it used the library <code>libsrtp</code> by Cisco, which, unfortunately, only has implementations for the same two algorithms.</p><p>There are two ways to go moving forward:</p><ul><li>Add necessary headers in <code>srtpenc</code> and the AES-CTR implementation in <code>libsrtp</code> upstream</li><li>Implement a GStreamer plugin that does what both <code>srtpenc</code> and <code>libsrtp</code> do with some help from <code>openssl</code></li></ul><p>Despite that, we were enticed to test the unencrypted stream as is. We had the following broadcast message (and a blank Chromecast display to go with it).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source_id&#34;</span><span class=p>:</span> <span class=s2>&#34;b7319b19-5641-472e-91d8-daeff9746a68&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;destination_id&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;namespace&#34;</span><span class=p>:</span> <span class=s2>&#34;urn:x-cast:com.google.cast.media&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;payload_utf8&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;requestId&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;currentTime&#34;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;disableStreamGrouping&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;media&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;contentId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;contentType&#34;</span><span class=p>:</span> <span class=s2>&#34;video/webm&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;metadata&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;metadataType&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Chrome tab casting&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;streamType&#34;</span><span class=p>:</span> <span class=s2>&#34;LIVE&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;mediaSessionId&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;playbackRate&#34;</span><span class=p>:</span> <span class=mf>1.0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;playerState&#34;</span><span class=p>:</span> <span class=s2>&#34;PLAYING&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;supportedMediaCommands&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;volume&#34;</span><span class=p>:</span> <span class=p>{</span> <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=mf>0.059999998658895493</span><span class=p>,</span> <span class=nt>&#34;muted&#34;</span><span class=p>:</span> <span class=kc>false</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;MEDIA_STATUS&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>What does all of this mean for the end-user? Do you wait patiently for us to code the plugin?<br>Of course not.<br>Remember that Chromecast also provides three streaming options with the media app, specifically the <code>Deafult Media Receiver</code> app (app id <code>CC1AD845</code>). We went with HLS.</p><p><figure style=flex-grow:180;flex-basis:433px><a href=/p/gsoc-finale/hls_stream_chromecast.jpg data-size=4382x2426><img src=/p/gsoc-finale/hls_stream_chromecast.jpg srcset="/p/gsoc-finale/hls_stream_chromecast_hu6dbc4d2c9ae95701ac10fab6b21db70f_2274972_480x0_resize_q75_box.jpg 480w, /p/gsoc-finale/hls_stream_chromecast_hu6dbc4d2c9ae95701ac10fab6b21db70f_2274972_1024x0_resize_q75_box.jpg 1024w" width=4382 height=2426 loading=lazy alt="Laptop screen mirrored on Chromecast"></a><figcaption>Laptop screen mirrored on Chromecast</figcaption></figure></p><p>There is still some time till this lands on <a class=link href=https://gitlab.gnome.org/GNOME/gnome-network-displays/-/merge_requests/171 target=_blank rel=noopener>the gitlab</a>. Some cleanup is left.<br>And the files (playlist file and the segment files) are served from an nginx server (with CORS header). So that needs to be inside the app as well. Soup is the answer to this one.</p><p>Now you won&rsquo;t be able to competitive game on this or use it as a second display, but this surely can handle presentations well.</p><p>Huge thanks to my mentors Benjamin Berg (@bberg) and Claudio Wunder (@cwunder).<br>This project was practically impossible to complete without their help.</p><p>PS: In the offer message, we set <code>castMode</code> to <code>mirroring</code>. There is a second option called <code>remoting</code>. From what we gathered, it is a dynamic mode that does not need the codec declarations beforehand and supports RPC messages for some reason. Our best bet is that this has to do with Chrome Remote Desktop and is of no interest to us.</p><hr><p>This isn&rsquo;t the finale. This is the beginning.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/gsoc/>gsoc</a>
<a href=/tags/gnome/>gnome</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/p/chromecast-protocol/><div class=article-image><img src=/p/chromecast-protocol/Big-Buck-Bunny.3be197f6b1bc585f07e3a11681645dce_hue1217febfeea9d26ee7ffeeabcc849ba_289699_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy data-key data-hash="md5-O+GX9rG8WF8H46EWgWRdzg=="></div><div class=article-details><h2 class=article-title>Chromecast Protocol</h2></div></a></article><article class=has-image><a href=/p/chromecast-connect/><div class=article-image><img src=/p/chromecast-connect/google-cast-logo.c34eafc45c141a22a3943af929d8677a_hu380fea45a8713440d3703426d8db7476_197587_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy data-key data-hash="md5-w06vxFwUGiKjlDr5Kdhneg=="></div><div class=article-details><h2 class=article-title>Chromecast Connect</h2></div></a></article><article class=has-image><a href=/p/gnome-introductory-post/><div class=article-image><img src=/p/gnome-introductory-post/GNOME-logo-500x316.564eaf3363b661663eeb3cd6c4e273cc_huc3a6bb4b474f9f0abf2bbc70e8fa6968_11449_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-Vk6vM2O2YWY+6zzWxOJzzA=="></div><div class=article-details><h2 class=article-title>GNOME Introductory Post</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2021 -
2022 kyte codes</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>