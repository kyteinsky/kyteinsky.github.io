<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Communication with a remote server only through DNS protocol"><title>DNS Based Communication</title><link rel=canonical href=https://kyteinsky.github.io/p/dns-based-communication/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="DNS Based Communication"><meta property="og:description" content="Communication with a remote server only through DNS protocol"><meta property="og:url" content="https://kyteinsky.github.io/p/dns-based-communication/"><meta property="og:site_name" content="kyte codes"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="dns"><meta property="article:tag" content="go"><meta property="article:published_time" content="2022-08-05T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-05T00:00:00+00:00"><meta property="og:image" content="https://kyteinsky.github.io/p/dns-based-communication/tunnel.jpeg"><meta name=twitter:title content="DNS Based Communication"><meta name=twitter:description content="Communication with a remote server only through DNS protocol"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kyteinsky.github.io/p/dns-based-communication/tunnel.jpeg"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended
on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu11112e8503aeb9bc837ec913758b86a7_10683_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></figure><h1 class=site-name><a href=https://kyteinsky.github.io>kyte codes</a></h1><h2 class=site-description>Developer to the rescue</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/dns-based-communication/><img src=/p/dns-based-communication/tunnel_hu29f415fab9b8f3f96ae730ba0c3cfccc_81487_800x0_resize_q75_box.jpeg srcset="/p/dns-based-communication/tunnel_hu29f415fab9b8f3f96ae730ba0c3cfccc_81487_800x0_resize_q75_box.jpeg 800w, /p/dns-based-communication/tunnel_hu29f415fab9b8f3f96ae730ba0c3cfccc_81487_1600x0_resize_q75_box.jpeg 1600w" width=800 height=534 loading=lazy alt="Featured image of post DNS Based Communication"></a></div><div class=article-details><header class=article-category><a href=/categories/recreational/ style=background-color:#b4d749;color:#000>Recreational Programming</a></header><h2 class=article-title><a href=/p/dns-based-communication/>DNS Based Communication</a></h2><h3 class=article-subtitle>Communication with a remote server only through DNS protocol</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Aug 05, 2022</time></footer></div></header><section class=article-content><blockquote><p>This project is about a DNS server that can handle communications (one way).</p></blockquote><h2 id=brief>Brief</h2><p>So what do I mean when I say it can handle communications? It means that you can send messages to a remote server, which happens to be an authoritative DNS server, in plain text as well as encrypted data.</p><p>The idea mainly stems from a Youtube video (whose link seems to have been lost in the internet haystack).<br>The person in the video explains its use case when you have a network with HTTP(S) ports blocked, some special service using some custom port, and the default DNS port 53 unblocked (maybe they forgot, maybe they use it for some reason).<br>This is a particular and unlikely situation, but the problem at hand is rather interesting. We need to make a DNS-based one-way message transfer protocol for fun.</p><h2 id=plan>Plan</h2><p>The exact action plan would be decided upon further inspection of the DNS protocol, its capabilities and limitations. For now, we won&rsquo;t bother ourselves with the fine details.</p><p>Without looking into the DNS specifications, here&rsquo;s a crude plan of how things should go:</p><p>The first step would be to create a DNS server that has access to the DNS query and gets some say in the response (yeah, some libraries can be used for <em>development ease</em>, and writing a response could be redundant).<br>Now that reading and writing are possible, it is time to define the protocol structure in Unga Bunga.</p><p>Usually, the query we send in a DNS request is a domain name structured in the form <code>abcd.efgh.com</code>.<br>We can use the actual domain name and sub-domain names to act as our payload here (allowed characters are 26 alphabet characters in lowercase, 10 digits, and 1 hyphen)</p><ul><li>as plain text</li><li>as encrypted text</li></ul><h4 id=plain-text>Plain text</h4><p>We can use hyphens to replace blank spaces and an encoding method as <code>0-</code> followed by the word to be capitalized in this manner: <code>hello-0-world</code>. This would mean <code>hello World</code>, and as a general rule of thumb, we could just make the first letter capital when such encoding was being used, giving us the sweet output <code>Hello World</code>.</p><h4 id=encrypted-text>Encrypted text</h4><p>We discuss encoded here too since there is not much difference between them once the plain text has been processed.<br>We have limitless power here. Just encrypt the text and use a total of 26+10+1 characters to pass it on, or just use the <em>here</em> less efficient hex characters directly obtained from the encoder or encryptor.</p><hr><p>But wait, the length of the domain is limited! How do we send a longer message?<br>Here comes the <code>com</code> part of the domain into the picture. It can specify if we have more content waiting to be sent or if we are finished.<br>Let us, for now, reserve the first character to check if we have more input to read: <code>0</code> for not finished yet and <code>1</code> for done.<br>And the following four characters for the sequence number. This shall start at <code>1</code> for the first partial message and go on increasing for the following messages. This ensures we assemble the whole message in the correct order in case they are not received in the same order as sent.</p><p>For the response part, we can follow in TCP&rsquo;s footsteps. We respond to all the queries with the sequence numbers of the received messages following <code>base 256</code> (to say). For sequence number <code>122</code>, we return IPv4 <code>0.0.0.122</code>, and for sequence number <code>257</code>, we return IPv4 <code>0.0.2.0</code>.</p><p>This should be enough planning for now, I guess.</p><p>I haven&rsquo;t used Go before in any project and want to learn it.<br>What better opportunity than this right here? Let&rsquo;s Go!</p></section><footer class=article-footer><section class=article-tags><a href=/tags/dns/>dns</a>
<a href=/tags/go/>go</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2021 -
2022 kyte codes</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>